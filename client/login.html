<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Fundamental Apparel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Hide scrollbar for cleaner look but keep functionality */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body class="h-screen overflow-hidden bg-white">

    <div class="flex h-full">

        <div
            class="hidden lg:flex w-1/2 bg-gray-50 flex-col justify-center items-center p-12 text-center border-r border-gray-100">
            <div class="max-w-lg">
                <a href="index.html" class="inline-block hover:opacity-80 transition-opacity" title="Back to Homepage">
                    <img src="images/logo.png" alt="Fundamental Apparel Logo"
                        class="w-40 h-40 mx-auto mb-8 object-contain">
                </a>

                <h1 class="text-4xl font-extrabold text-gray-900 mb-2">Fundamental <span
                        class="text-gray-600">Apparel</span></h1>

                <h2 class="text-xl font-semibold text-gray-800 mt-6 mb-4">Shop with Fundamental Apparel</h2>

                <p class="text-gray-600 text-lg leading-relaxed">
                    Browse through our diverse range of meticulously crafted garments, designed to bring out your
                    individuality and cater to your sense of style.
                </p>
            </div>
        </div>

        <div
            class="w-full lg:w-1/2 h-full overflow-y-auto hide-scrollbar bg-white flex flex-col justify-center items-center p-6 sm:p-12">

            <div class="w-full max-w-md">
                <div class="lg:hidden text-center mb-8">
                    <a href="index.html" class="inline-block hover:opacity-80 transition-opacity">
                        <img src="images/logo.png" alt="Fundamental Apparel Logo"
                            class="w-24 h-24 mx-auto mb-4 object-contain">
                    </a>
                    <h1 class="text-2xl font-bold text-gray-900">Fundamental Apparel</h1>
                </div>

                <div class="text-left mb-8 hidden lg:block">
                    <h2 class="text-3xl font-bold text-gray-900">Sign in</h2>
                    <p class="text-gray-500 mt-2">to your Fundamental account</p>
                </div>

                <div id="message-container" class="hidden mb-4 p-4 rounded-md text-sm"></div>

                <form id="login-form" class="space-y-5">

                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="email" name="email" required placeholder="email@domain.com"
                            class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent outline-none transition bg-white text-gray-900">
                    </div>

                    <div>
                        <div class="flex justify-between items-center mb-1">
                            <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                        </div>
                        <input type="password" id="password" name="password" placeholder="••••••••"
                            class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent outline-none transition bg-white text-gray-900">
                        <div class="flex justify-end mt-2">
                            <a href="forgot-password.html"
                                class="text-sm font-medium text-blue-600 hover:text-blue-800">Forgot password?</a>
                        </div>
                    </div>

                    <div class="flex items-start gap-3">
                        <input id="agreePolicyLogin" type="checkbox" required class="mt-1 h-4 w-4" />
                        <label for="agreePolicyLogin" class="text-sm text-gray-600">By continuing, you agree to our
                            <a href="#" class="text-blue-600 hover:underline policy-link" data-open="policyModal">Privacy Policy</a>
                            and
                            <a href="#" class="text-blue-600 hover:underline policy-link" data-open="policyModal">Terms &amp; Conditions</a>.
                        </label>
                    </div>

                    <button type="submit" id="submit-btn"
                        class="w-full bg-gray-900 text-white font-bold py-3.5 rounded-lg hover:bg-black transition transform active:scale-[0.98] duration-200 shadow-md">
                        Sign In
                    </button>
                </form>

                <div class="relative my-8">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-200"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-2 bg-white text-gray-500">Or sign in with</span>
                    </div>
                </div>

                <div class="space-y-3">
                    <button id="google-btn" type="button"
                        class="w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition">
                        <i class="fab fa-google text-lg mr-3"></i>
                        Sign In with Google
                    </button>

                    <button id="facebook-btn" type="button"
                        class="w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition">
                        <i class="fab fa-facebook text-lg mr-3 text-blue-600"></i>
                        Sign In with Facebook
                    </button>
                </div>

                <div class="text-center mt-8">
                    <p class="text-sm text-gray-600">
                        Don't have an account?
                        <a href="register.html" class="font-bold text-gray-900 hover:underline">Create one</a>
                    </p>
                </div>

                <div class="h-8 md:hidden"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://fundamental-apparel-backend.onrender.com'; // Update this to match your server
        const form = document.getElementById('login-form');
        const messageContainer = document.getElementById('message-container');
        const submitBtn = document.getElementById('submit-btn');
        const googleBtn = document.getElementById('google-btn');
        const facebookBtn = document.getElementById('facebook-btn');

        const showMessage = (message, type) => {
            messageContainer.textContent = message;
            messageContainer.className = `p-4 rounded-md mb-4 text-sm ${type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-800'}`;
            messageContainer.classList.remove('hidden');
        };

        // Google OAuth
        googleBtn.addEventListener('click', () => {
            window.location.href = `${API_BASE}/api/auth/google`;
        });

        // Facebook OAuth
        facebookBtn.addEventListener('click', () => {
            window.location.href = `${API_BASE}/api/auth/facebook`;
        });

        form.addEventListener('submit', async (e) => {
            // Ensure policy checkbox is checked (HTML `required` handles this, but double-check for JS-driven submits)
            const agree = document.getElementById('agreePolicyLogin');
            if(!agree || !agree.checked){
                alert('Please agree to the Privacy Policy and Terms & Conditions to continue.');
                return;
            }
            e.preventDefault();
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            submitBtn.disabled = true;
            submitBtn.textContent = 'Logging In...';

            try {
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();

                if (!result.success && result.verificationRequired) {
                    alert('Your account is not verified. Redirecting you to the verification page.');
                    window.location.href = `verify.html?email=${encodeURIComponent(result.email)}`;
                    return;
                }
                // Handle set-password flow when server indicates user exists but has no password
                if (result && result.needsSetPassword) {
                    // Token is returned in response; redirect user to reset-password page
                    const token = result.token;
                    const emailParam = encodeURIComponent(result.email || data.email || '');
                    window.location.href = `reset-password.html?token=${encodeURIComponent(token)}&email=${emailParam}`;
                    return;
                }

                if (result.success) {
                    localStorage.setItem('token', result.token);
                    // Check kung admin
                    if (result.user && result.user.role === 'admin') {
                        localStorage.setItem('adminToken', result.token); // I-set din ang adminToken
                        window.location.href = 'admin/index.html'; // I-redirect sa admin
                    } else {
                        window.location.href = 'index.html'; // I-redirect sa user homepage
                    }
                } else {
                    throw new Error(result.msg || 'An error occurred.');
                }
            } catch (error) {
                showMessage(error.message, 'error');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Sign In';
            }
        });

        // Policy modal handling
        function openPolicyModal(){
            const modal = document.getElementById('policyModal');
            if(modal){
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }
        }
        function closePolicyModal(){
            const modal = document.getElementById('policyModal');
            if(modal){
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }
        }
        document.querySelectorAll('.policy-link').forEach(a=>{
            a.addEventListener('click', (ev)=>{ ev.preventDefault(); openPolicyModal(); });
        });

        // Close modal on Escape, clicking the close button, or clicking outside the dialog
        document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closePolicyModal(); });
        document.addEventListener('click', (e)=>{
            // handle dynamically if modal exists
            const modal = document.getElementById('policyModal');
            if(!modal) return;
            // close when clicking the close button
            if(e.target && (e.target.id === 'policyClose' || (e.target.closest && e.target.closest('#policyClose')))) {
                closePolicyModal();
                return;
            }
            // close when clicking on overlay area
            if(e.target && e.target.id === 'policyModal') {
                closePolicyModal();
            }
        });
        // Close when clicking on overlay (outside inner dialog)
        (function(){
            const modal = document.getElementById('policyModal');
            if(modal){
                modal.addEventListener('click', (ev)=>{
                    if(ev.target === modal) closePolicyModal();
                });
            }
        })();
    </script>

        <!-- Policy Modal (contains Privacy Policy and Terms & Conditions) -->
        <div id="policyModal" class="hidden fixed inset-0 bg-black/60 z-50 items-center justify-center" role="dialog" aria-modal="true" aria-labelledby="policyTitle" tabindex="-1">
            <div class="bg-white max-w-4xl w-[90%] max-h-[85vh] overflow-y-auto rounded-lg p-6 mx-auto shadow-lg ring-1 ring-black/5">
                <div class="flex items-center justify-between gap-4 mb-4">
                    <h2 id="policyTitle" class="text-2xl font-semibold text-gray-900">Privacy Policy &amp; Terms &amp; Conditions</h2>
                    <button id="policyClose" class="text-gray-600 hover:text-gray-900 bg-gray-100 px-3 py-1 rounded-md">Close ✕</button>
                </div>
                <div class="prose text-sm text-gray-700">
                    <section class="space-y-3">
                        <h3 class="text-lg font-semibold text-gray-900">Privacy Policy</h3>
                        <p class="leading-relaxed">Fundamental Apparel collects and processes personal information necessary to provide our services, manage orders, and communicate with customers. We collect contact information (name, email, phone), shipping addresses, order history, and any files you upload when using our Custom Upload services. Images and files uploaded as part of reviews or custom orders are stored securely and are accessible to staff for fulfillment and moderation purposes.</p>
                        <p class="leading-relaxed">We use this information to fulfill orders, provide customer support, send transactional emails (order confirmations, shipping updates), and for fraud prevention. We do not sell personal data to third parties. For payment processing we share only necessary data with payment providers. You may request data access or deletion by contacting support.</p>
                    </section>

                    <section class="space-y-3 mt-4">
                        <h3 class="text-lg font-semibold text-gray-900">Data and Image Usage</h3>
                        <p class="leading-relaxed">By uploading images (reviews or custom designs), you grant Fundamental Apparel a non-exclusive license to store and process those images for the purpose of order fulfillment, displaying reviews (if allowed), and customer service. If an uploaded image contains sensitive content, please contact support to request removal.</p>
                    </section>

                    <section class="space-y-3 mt-4">
                        <h3 class="text-lg font-semibold text-gray-900">Terms &amp; Conditions</h3>
                        <p class="leading-relaxed">Orders are subject to stock availability and our inventory checks. Custom orders submitted via the Custom Upload flow are quotes and require confirmation. Payments, refunds, and returns are handled according to our Returns &amp; Refunds policy. Service orders may be excluded from loyalty rewards; admin controls apply.</p>
                        <p class="leading-relaxed">Customers must provide accurate contact and shipping information. We reserve the right to cancel or modify orders in case of inventory errors, pricing mistakes, or suspected fraud. By creating an account and placing orders you agree to pay applicable fees and follow our usage guidelines.</p>
                    </section>

                    <section class="space-y-2 mt-4">
                        <h3 class="text-lg font-semibold text-gray-900">Contact</h3>
                        <p class="leading-relaxed">If you have questions about privacy or these terms, contact us at <a href="mailto:support@fundamental.example" class="text-indigo-600 hover:underline">support@fundamental.example</a> (replace with your operational support email) or through the admin contact channels.</p>
                    </section>
                </div>
            </div>
        </div>
</body>

</html>