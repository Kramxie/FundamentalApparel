<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customize Jersey - Fundamental</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .customizer-tab {
            padding-left: 1.25rem;
            padding-right: 1.25rem;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: rgb(75 85 99);
            border-radius: 0.375rem;
            cursor: pointer;
        }

        .customizer-tab.active {
            background-color: rgb(224 231 255);
            color: rgb(67 56 202);
        }

        .design-option {
            border-width: 2px;
            border-color: transparent;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .design-option:hover {
            border-color: rgb(99 102 241);
        }

        .design-option.active {
            border-color: rgb(99 102 241);
            box-shadow: 0 0 0 2px rgb(165 180 252);
        }

        .design-option img {
            width: 100%;
            height: 6rem;
            object-fit: contain;
            border-radius: 0.375rem;
            background-color: rgb(243 244 246);
            padding: 0.25rem;
        }
    </style>
</head>

<body class="bg-gray-50">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-gray-800"><a href="index.html">Fundamental</a></div>
            <div class="hidden md:flex space-x-8 items-center">
                <a href="index.html" class="text-gray-600 hover:text-indigo-600">Home</a>
                <a href="products.html" class="text-gray-600 hover:text-indigo-600">Products</a>
                <a href="services.html" class="text-gray-800 font-semibold">Services</a>
                <a href="#" class="text-gray-600 hover:text-indigo-600">About</a>
                <a href="#" class="text-gray-600 hover:text-indigo-600">Contact</a>
            </div>
            <div class="flex items-center space-x-5">
                <a href="cart.html" class="text-gray-600 hover:text-indigo-600 relative"><i
                        class="fas fa-shopping-cart"></i></a>
                <div id="auth-links-logged-out" class="flex items-center space-x-3">
                    <a href="login.html" class="text-sm font-medium text-gray-700 hover:text-indigo-600">Log In</a>
                    <a href="register.html"
                        class="text-sm font-medium bg-indigo-600 text-white px-3 py-1.5 rounded-md hover:bg-indigo-700">Register</a>
                </div>
                <div id="auth-links-logged-in" class="hidden">
                    <a href="profile.html" id="user-link" class="text-gray-600 hover:text-indigo-600">
                        <i id="user-icon" class="fas fa-user-circle text-2xl"></i>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <h1 class="text-3xl font-bold text-gray-900 mb-8">Customize Jersey</h1>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md flex items-center justify-center min-h-[600px]">
                <img id="jersey-preview" src="https://via.placeholder.com/600x800/e2e8f0/cccccc?text=Jersey+Preview"
                    alt="Customize Jersey Preview" class="max-w-full h-auto max-h-[70vh]">
            </div>

            <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-md">

                <h2 class="text-lg font-semibold mb-2">Customize Jersey</h2>
                <button id="change-product" class="text-sm text-indigo-600 hover:underline">Change Product</button>

                <hr class="my-6">

                <div id="message-container" class="hidden mb-4 p-4 rounded-md"></div>

                <div class="space-y-4">
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="radio" name="custom_mode" id="mode-template" class="h-4 w-4" value="Template"
                            checked>
                        <span class="font-medium">Customize Jersey</span>
                    </label>

                    <div id="template-options" class="pl-7">
                        <div class="flex items-center gap-2 bg-gray-100 p-1 rounded-lg mb-4">
                            <button data-tab="design" class="customizer-tab active">Design</button>
                            <button data-tab="colors" class="customizer-tab">Colors</button>
                            <button data-tab="text" class="customizer-tab">Text</button>
                            <button data-tab="logos" class="customizer-tab">Logos</button>
                        </div>

                        <div id="tab-content">
                            <div id="tab-design">
                                <div id="design-grid" class="grid grid-cols-3 gap-3">
                                    <div class="design-option active" data-design="Legend"><img
                                            src="https://via.placeholder.com/100x100/e2e8f0/9ca3af?text=Legend"
                                            alt="Legend">
                                        <p class="text-xs text-center">Legend</p>
                                    </div>
                                    <div class="design-option" data-design="Screen"><img
                                            src="https://via.placeholder.com/100x100/e2e8f0/9ca3af?text=Screen"
                                            alt="Screen">
                                        <p class="text-xs text-center">Screen</p>
                                    </div>
                                    <div class="design-option" data-design="Fly"><img
                                            src="https://via.placeholder.com/100x100/e2e8f0/9ca3af?text=Fly" alt="Fly">
                                        <p class="text-xs text-center">Fly</p>
                                    </div>
                                    <div class="design-option" data-design="Triple"><img
                                            src="https://via.placeholder.com/100x100/e2e8f0/9ca3af?text=Triple"
                                            alt="Triple">
                                        <p class="text-xs text-center">Triple</p>
                                    </div>
                                    <div class="design-option" data-design="Buzzer"><img
                                            src="https://via.placeholder.com/100x100/e2e8f0/9ca3af?text=Buzzer"
                                            alt="Buzzer">
                                        <p class="text-xs text-center">Buzzer</p>
                                    </div>
                                    <div class="design-option" data-design="Hero"><img
                                            src="https://via.placeholder.com/100x100/e2e8f0/9ca3af?text=Hero"
                                            alt="Hero">
                                        <p class="text-xs text-center">Hero</p>
                                    </div>
                                </div>
                            </div>
                            <div id="tab-colors" class="hidden">
                                <p class="text-sm text-gray-500">Color options coming soon...</p>
                            </div>
                            <div id="tab-text" class="hidden">
                                <p class="text-sm text-gray-500">Text options coming soon...</p>
                            </div>
                            <div id="tab-logos" class="hidden">
                                <p class="text-sm text-gray-500">Logo upload coming soon...</p>
                            </div>
                        </div>
                    </div>

                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="radio" name="custom_mode" id="mode-upload" class="h-4 w-4" value="FileUpload">
                        <span class="font-medium">Upload Design File</span>
                    </label>
                    <p class="text-xs text-gray-500 pl-7">(For 10 minimum pairs only)</p>

                    <div id="upload-options" class="hidden pl-7">
                        <input type="file" id="design-file-input"
                            class="block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                    </div>
                </div>

                <hr class="my-6">

                <div class="space-y-4">
                    <div>
                        <label for="quantity" class="block text-sm font-medium text-gray-700">Quantity</label>
                        <input type="number" id="quantity" name="quantity" min="1" value="1"
                            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                    </div>
                    <div>
                        <label for="notes" class="block text-sm font-medium text-gray-700">Notes / Instructions</label>
                        <textarea id="notes" name="notes" rows="3"
                            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"
                            placeholder="e.g., Ilagay ang logo sa kaliwang dibdib. Palitan ang kulay ng text."></textarea>
                    </div>
                </div>
                <hr class="my-6">

                <button id="save-btn" class="w-full bg-gray-900 text-white font-bold py-3 rounded-md hover:bg-gray-700">
                    Submit Request for Quote
                </button>
            </div>

        </div>
    </main>

    <div id="site-footer"></div>
    <script src="js/footer.js"></script>

    <script>
        const API_BASE = 'https://unmumbled-balloonlike-gayle.ngrok-free.dev'; // O ang ngrok URL mo

        // Auth UI Script
        (async () => {
            const token = localStorage.getItem('token');
            const authLoggedOut = document.getElementById('auth-links-logged-out');
            const authLoggedIn = document.getElementById('auth-links-logged-in');
            if (!token) { authLoggedOut.classList.remove('hidden'); authLoggedIn.classList.add('hidden'); return; }
            try {
                const res = await fetch(`${API_BASE}/api/auth/me`, { headers: { 'Authorization': `Bearer ${token}` } });
                if (res.ok) { authLoggedOut.classList.add('hidden'); authLoggedIn.classList.remove('hidden'); }
                else { throw new Error('Token failed'); }
            } catch (err) {
                localStorage.removeItem('token');
                authLoggedOut.classList.remove('hidden');
                authLoggedIn.classList.add('hidden');
            }
        })();

        // Customizer Script
        document.addEventListener('DOMContentLoaded', () => {
            const modeTemplate = document.getElementById('mode-template');
            const modeUpload = document.getElementById('mode-upload');
            const templateOptions = document.getElementById('template-options');
            const uploadOptions = document.getElementById('upload-options');
            const saveBtn = document.getElementById('save-btn');
            const messageContainer = document.getElementById('message-container');

            let selectedDesign = 'Legend'; // Default design

            const showMessage = (message, type) => {
                messageContainer.textContent = message;
                messageContainer.className = `p-4 rounded-md mb-4 text-sm ${type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-800'}`;
                messageContainer.classList.remove('hidden');
            };

            // Radio button logic
            modeTemplate.addEventListener('change', () => {
                if (modeTemplate.checked) {
                    templateOptions.classList.remove('hidden');
                    uploadOptions.classList.add('hidden');
                }
            });
            modeUpload.addEventListener('change', () => {
                if (modeUpload.checked) {
                    templateOptions.classList.add('hidden');
                    uploadOptions.classList.remove('hidden');
                }
            });

            // Tab logic
            const tabs = document.querySelectorAll('.customizer-tab');
            const tabContents = document.querySelectorAll('#tab-content > div');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const tabName = tab.dataset.tab;
                    tabContents.forEach(content => {
                        content.classList.toggle('hidden', content.id !== `tab-${tabName}`);
                    });
                });
            });

            // Design selection logic
            const designOptions = document.querySelectorAll('.design-option');
            designOptions.forEach(option => {
                option.addEventListener('click', () => {
                    designOptions.forEach(o => o.classList.remove('active'));
                    option.classList.add('active');
                    selectedDesign = option.dataset.design;
                    console.log('Selected design:', selectedDesign);
                });
            });

            // --- MODIFIED: Save button logic ---
            saveBtn.addEventListener('click', async () => {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Please log in to submit your custom design request.');
                    window.location.href = 'login.html';
                    return;
                }

                saveBtn.disabled = true;
                saveBtn.textContent = 'Submitting...';

                // Gumamit ng FormData dahil mag-a-upload ng file
                const formData = new FormData();

                const customMode = document.querySelector('input[name="custom_mode"]:checked').value;
                const quantity = document.getElementById('quantity').value;
                const notes = document.getElementById('notes').value;

                formData.append('customType', customMode);
                formData.append('quantity', quantity);
                formData.append('notes', notes);

                if (customMode === 'Template') {
                    // I-serialize ang template details
                    // (For now, design lang muna)
                    const designDetails = `Design: ${selectedDesign}`;
                    formData.append('designDetails', designDetails);
                }
                else if (customMode === 'FileUpload') {
                    const fileInput = document.getElementById('design-file-input');
                    if (!fileInput.files[0]) {
                        showMessage('Please upload your design file.', 'error');
                        saveBtn.disabled = false;
                        saveBtn.textContent = 'Submit Request for Quote';
                        return;
                    }
                    formData.append('designFile', fileInput.files[0]);
                }

                try {
                    const response = await fetch(`${API_BASE}/api/custom-orders`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`
                            // HUWAG mag-set ng 'Content-Type', hahayaan natin ang browser/FormData
                        },
                        body: formData
                    });

                    const result = await response.json();

                    if (result.success) {
                        alert(result.msg || 'Your request has been submitted! We will contact you soon.');
                        window.location.href = 'services.html'; // Bumalik sa services page
                    } else {
                        throw new Error(result.msg || 'Failed to submit request.');
                    }
                } catch (err) {
                    showMessage(err.message, 'error');
                } finally {
                    saveBtn.disabled = false;
                    saveBtn.textContent = 'Submit Request for Quote';
                }
            });
        });
    </script>

    <!-- Socket.io Client -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <!-- Chat Widget -->
    <script src="js/chat.js"></script>
</body>

</html>